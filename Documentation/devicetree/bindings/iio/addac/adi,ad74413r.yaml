# SPDX-License-Identifier: (GPL-2.0-only OR BSD-2-Clause)
%YAML 1.2
---
$id: http://devicetree.org/schemas/iio/addac/adi,ad74413r.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: Analog Devices AD74413R/AD74412R device driver

maintainers:
  - Cosmin Tanislav <cosmin.tanislav@analog.com>

description: |
  The AD74413R and AD74412R are quad-channel software configurable input/output
  solutions for building and process control applications. They contain
  functionality for analog output, analog input, digital input, resistance
  temperature detector, and thermocouple measurements integrated
  into a single chip solution with an SPI interface.
  The devices feature a 16-bit ADC and four configurable 13-bit DACs to provide
  four configurable input/output channels and a suite of diagnostic functions.

properties:
  compatible:
    enum:
      - adi,ad74413r
      - adi,ad74412r

  reg:
    maxItems: 1

  '#address-cells':
    const: 1

  '#size-cells':
    const: 0

  spi-max-frequency:
    maximum: 1000000

  spi-cpol: true

  interrupts:
    maxItems: 1

  refin-supply:
    description:
      Reference voltage regulator.

  adi,rsense-resistance-ohms:
    $ref: /schemas/types.yaml#/definitions/uint32
    description:
      RSense resistance values in Ohms.

required:
  - compatible
  - reg
  - spi-max-frequency
  - spi-cpol
  - refin-supply
  - adi,rsense-resistance-ohm

additionalProperties: false

patternProperties:
  "^channel@[0-3]$":
    type: object
    description: Represents the external channels which are connected to the device.

    properties:
      reg:
        description: |
          The channel number. It can have up to 4 channels numbered from 0 to 3.
        maxItems: 1
        minimum: 0
        maximum: 3

      adi,ch-func:
        $ref: /schemas/types.yaml#/definitions/uint32
        description: |
          Channel function.
          HART functions are not supported on AD74412R.
          0 - CH_FUNC_HIGH_IMPEDANCE
          1 - CH_FUNC_VOLTAGE_OUTPUT
          2 - CH_FUNC_CURRENT_OUTPUT
          3 - CH_FUNC_VOLTAGE_INPUT
          4 - CH_FUNC_CURRENT_INPUT_EXT_POWER
          5 - CH_FUNC_CURRENT_INPUT_LOOP_POWER
          6 - CH_FUNC_RESISTANCE_INPUT
          7 - CH_FUNC_DIGITAL_INPUT_LOGIC
          8 - CH_FUNC_DIGITAL_INPUT_LOOP_POWER
          9 - CH_FUNC_CURRENT_INPUT_EXT_POWER_HART
          10 - CH_FUNC_CURRENT_INPUT_LOOP_POWER_HART
        maxItems: 1
        minimum: 0
        maximum: 10

      adi,gpo-config:
        $ref: /schemas/types.yaml#/definitions/uint32
        description: |
          GPO config.
          0 - GPO_CONFIG_100K_PULL_DOWN
          1 - GPO_CONFIG_LOGIC
          3 - GPO_CONFIG_DEBOUNCED_COMPARATOR
          4 - GPO_CONFIG_HIGH_IMPEDANCE
        maxItems: 1
        enum: [0, 1, 3, 4]

    required:
      - reg

examples:
  - |
    spi0 {
      #address-cells = <1>;
      #size-cells = <0>;

      cs-gpios = <&gpio 17 GPIO_ACTIVE_LOW>;
      status = "okay";

      ad74413r@0 {
        compatible = "adi,ad74413r";
        reg = <0>;
        spi-max-frequency = <1000000>;
        spi-cpol;

        #address-cells = <1>;
        #size-cells = <0>;

        interrupt-parent = <&gpio>;
        interrupts = <26 0>;

        refin-supply = <&ad74413r_refin>;
        adi,rsense-resistance-ohm = <100>;

        channel@0 {
          reg = <0>;

          adi,ch-func = <CH_FUNC_VOLTAGE_OUTPUT>;
          adi,gpo-config = <GPO_CONFIG_LOGIC>;
        };

        channel@1 {
          reg = <1>;

          adi,ch-func = <CH_FUNC_CURRENT_OUTPUT>;
          adi,gpo-config = <GPO_CONFIG_LOGIC>;
        };

        channel@2 {
          reg = <2>;

          adi,ch-func = <CH_FUNC_VOLTAGE_INPUT>;
          adi,gpo-config = <GPO_CONFIG_DEBOUNCED_COMPARATOR>;
        };

        channel@3 {
          reg = <3>;

          adi,ch-func = <CH_FUNC_CURRENT_INPUT_EXT_POWER>;
          adi,gpo-config = <GPO_CONFIG_DEBOUNCED_COMPARATOR>;
        };
      };
    };
...
